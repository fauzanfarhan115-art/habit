<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Benerin Hidup Gue</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .stats {
            background: rgba(255,255,255,0.95);
            padding: 20px; border-radius: 15px; margin-bottom: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 0.9em; color: #666; }
        .input-section, .templates-section, .table-wrapper, .reflection-section, .analytics-section {
            background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .input-row { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
        #habitInput { flex: 1; padding: 15px; border: 2px solid #667eea; border-radius: 10px; }
        #btnTambah {
            padding: 15px 35px; background: #667eea; color: white; border: none;
            border-radius: 10px; cursor: pointer; font-weight: bold;
        }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 12px; border: 1px solid #e0e0e0; text-align: center; }
        th { background: #667eea; color: white; }
        td:first-child { 
            position: sticky; left: 0; background: white; z-index: 5; 
            text-align: left; font-weight: bold; border-right: 2px solid #667eea; 
        }
        .streak-badge { color: #ff6b6b; font-size: 0.8em; }
        input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        input[type="checkbox"]:disabled { cursor: not-allowed; opacity: 0.5; }
        .today-col { background-color: #fff9e6 !important; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 5px; border-radius: 4px; cursor: pointer; font-size: 10px; }
        .bar-chart { display: flex; align-items: flex-end; height: 150px; gap: 10px; border-bottom: 1px solid #ddd; }
        .bar { flex: 1; background: #667eea; position: relative; border-radius: 3px 3px 0 0; }
        .bar-label { position: absolute; bottom: -20px; width: 100%; text-align: center; font-size: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Habit Tracker</h1>
            <div id="monthDisplay" class="month-display"></div>
        </div>

        <div class="stats">
            <div class="stat-item"><div class="stat-number" id="totalHabits">0</div><div class="stat-label">Habits</div></div>
            <div class="stat-item"><div class="stat-number" id="todayChecked">0</div><div class="stat-label">Selesai Hari Ini</div></div>
            <div class="stat-item"><div class="stat-number" id="longestStreak">0</div><div class="stat-label">Longest Streak üî•</div></div>
        </div>

        <div class="input-section">
            <div class="input-row">
                <input type="text" id="habitInput" placeholder="Habit baru...">
                <button id="btnTambah" onclick="addHabit()">TAMBAH</button>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="table-container">
                <table>
                    <thead><tr id="tableHeader"><th>Habit & Streak</th></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div class="analytics-section">
            <h3>üìà 7 Hari Terakhir</h3>
            <div class="bar-chart" id="weeklyChart"></div>
        </div>

        <div class="reflection-section">
            <h3>üìù Refleksi Harian</h3>
            <textarea id="dailyReflection" style="width: 100%; min-height: 100px; padding: 10px; border-radius: 10px; border: 1px solid #ddd;"></textarea>
        </div>
    </div>

    <script>
        let habits = [];
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        const todayDate = now.getDate();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        function init() {
            loadFromStorage();
            renderHeader();
            renderHabits();
            updateStats();
            renderWeeklyChart();
            setupAutoSave();
            document.getElementById('monthDisplay').textContent = 
                new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(now);
        }

        function renderHeader() {
            const header = document.getElementById('tableHeader');
            header.innerHTML = '<th>Habit & Streak</th>';
            for (let i = 1; i <= daysInMonth; i++) {
                const th = document.createElement('th');
                th.textContent = i;
                if (i === todayDate) th.classList.add('today-col');
                header.appendChild(th);
            }
        }

        function addHabit() {
            const input = document.getElementById('habitInput');
            if (!input.value.trim()) return;
            
            const newHabit = {
                id: Date.now(),
                name: input.value.trim(),
                checks: {}
            };
            habits.push(newHabit);
            input.value = '';
            saveAndRefresh();
        }

        function toggleCheck(id, day) {
            const habit = habits.find(h => h.id === id);
            if (habit) {
                habit.checks[day] = !habit.checks[day];
                saveAndRefresh();
            }
        }

        function calculateStreak(habit) {
            let streak = 0;
            for (let i = todayDate; i >= 1; i--) {
                if (habit.checks[i]) streak++;
                else if (i < todayDate) break;
            }
            return streak;
        }

        function renderHabits() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            if (habits.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${daysInMonth+1}">Belum ada data.</td></tr>`;
                return;
            }

            habits.forEach(habit => {
                const tr = document.createElement('tr');
                const streak = calculateStreak(habit);
                
                let tdName = `<td>
                    <div>${habit.name}</div>
                    <div class="streak-badge">üî• ${streak} Hari</div>
                    <button class="delete-btn" onclick="deleteHabit(${habit.id})">Hapus</button>
                </td>`;
                tr.innerHTML = tdName;

                for (let d = 1; d <= daysInMonth; d++) {
                    const td = document.createElement('td');
                    if (d === todayDate) td.classList.add('today-col');

                    const cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.checked = habit.checks[d] || false;

                    // LOGIKA PENGUNCIAAN: Hanya hari ini yang bisa dicentang
                    if (d === todayDate) {
                        cb.onchange = () => toggleCheck(habit.id, d);
                    } else {
                        cb.disabled = true;
                        cb.title = d < todayDate ? "Masa lalu tidak bisa diubah." : "Belum waktunya.";
                    }

                    td.appendChild(cb);
                    tr.appendChild(td);
                }
                tbody.appendChild(tr);
            });
        }

        function updateStats() {
            document.getElementById('totalHabits').textContent = habits.length;
            document.getElementById('todayChecked').textContent = habits.filter(h => h.checks[todayDate]).length;
            
            let maxStreak = 0;
            habits.forEach(h => {
                const s = calculateStreak(h);
                if (s > maxStreak) maxStreak = s;
            });
            document.getElementById('longestStreak').textContent = maxStreak;
        }

        function renderWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            chart.innerHTML = '';
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(todayDate - i);
                const dayLabel = d.getDate();
                const done = habits.filter(h => h.checks[dayLabel]).length;
                const height = habits.length ? (done / habits.length) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = height + '%';
                bar.innerHTML = `<span class="bar-label">${dayLabel}</span>`;
                chart.appendChild(bar);
            }
        }

        function deleteHabit(id) {
            if (confirm('Hapus habit?')) {
                habits = habits.filter(h => h.id !== id);
                saveAndRefresh();
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('habitTrackerData', JSON.stringify({
                habits, month: currentMonth, year: currentYear
            }));
            renderHabits();
            updateStats();
            renderWeeklyChart();
        }

        function loadFromStorage() {
            const data = JSON.parse(localStorage.getItem('habitTrackerData'));
            if (data && data.month === currentMonth && data.year === currentYear) {
                habits = data.habits || [];
            }
        }

        function setupAutoSave() {
            const ref = document.getElementById('dailyReflection');
            ref.value = localStorage.getItem('reflection_' + todayDate) || '';
            ref.oninput = () => localStorage.setItem('reflection_' + todayDate, ref.value);
        }

        init();
    </script>
</body>
</html>
