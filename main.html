<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Benerin Hidup Gue</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to bottom, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .quote-box { background: white; padding: 15px; border-radius: 10px; margin: 15px 0; color: #5a6c7d; font-style: italic; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-left: 4px solid #3498db; }
        .stats {
            background: white;
            padding: 20px; border-radius: 15px; margin-bottom: 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #3498db; }
        .stat-label { font-size: 0.9em; color: #7f8c8d; }
        .input-section, .templates-section, .table-wrapper, .reflection-section, .analytics-section {
            background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .input-row { display: flex; gap: 15px; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
        #habitInput { flex: 1; min-width: 200px; padding: 15px; border: 2px solid #3498db; border-radius: 10px; }
        #categorySelect, #goalInput { padding: 15px; border: 2px solid #3498db; border-radius: 10px; }
        #btnTambah {
            padding: 15px 35px; background: #3498db; color: white; border: none;
            border-radius: 10px; cursor: pointer; font-weight: bold; transition: background 0.3s;
        }
        #btnTambah:hover { background: #2980b9; }
        .view-toggle { display: flex; gap: 10px; margin-bottom: 20px; }
        .view-btn { padding: 10px 20px; background: #ecf0f1; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: #34495e; transition: all 0.3s; }
        .view-btn.active { background: #3498db; color: white; }
        .view-btn:hover { background: #bdc3c7; }
        .view-btn.active:hover { background: #2980b9; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .calendar-day { 
            aspect-ratio: 1; background: #f8f9fa; border-radius: 8px; padding: 10px; 
            cursor: pointer; border: 2px solid transparent; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .calendar-day:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .calendar-day.today { border-color: #3498db; background: #ebf5fb; }
        .calendar-day .day-num { font-weight: bold; margin-bottom: 5px; color: #2c3e50; }
        .calendar-day .completion { font-size: 0.8em; color: #7f8c8d; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { padding: 15px 12px; border: 1px solid #ecf0f1; text-align: center; }
        th { background: #f8f9fa; color: #2c3e50; font-weight: 600; font-size: 0.9em; border-bottom: 2px solid #3498db; }
        td:first-child { 
            position: sticky; left: 0; background: white; z-index: 5; 
            text-align: left; border-right: 2px solid #ecf0f1; 
        }
        tr:hover { background: #f8f9fa; }
        tr:hover td:first-child { background: #f8f9fa; }
        .streak-badge { color: #e74c3c; font-size: 0.8em; }
        .category-badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.75em; margin-left: 5px; }
        .cat-kesehatan { background: #d5f4e6; color: #27ae60; }
        .cat-produktivitas { background: #dae8fc; color: #3498db; }
        .cat-belajar { background: #fff4e6; color: #e67e22; }
        .cat-sosial { background: #fde2e4; color: #e74c3c; }
        .cat-keuangan { background: #e8daef; color: #8e44ad; }
        .cat-kebiasaan { background: #d6eaf8; color: #2980b9; }
        input[type="checkbox"] { 
            width: 22px; height: 22px; cursor: pointer;
            appearance: none;
            border: 2px solid #ddd;
            border-radius: 6px;
            position: relative;
            transition: all 0.3s ease;
        }
        input[type="checkbox"]:checked {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
        }
        input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 16px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        input[type="checkbox"]:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .today-col { 
            background-color: #fff9e6 !important; 
            font-weight: 600;
            position: relative;
        }
        .today-col::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; margin-left: 5px; }
        .edit-btn { background: #3498db; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; }
        .bar-chart { display: flex; align-items: flex-end; height: 150px; gap: 10px; border-bottom: 1px solid #ddd; margin-top: 20px; }
        .bar { flex: 1; background: #667eea; position: relative; border-radius: 3px 3px 0 0; min-height: 5px; }
        .bar-label { position: absolute; bottom: -20px; width: 100%; text-align: center; font-size: 10px; }
        .bar-value { position: absolute; top: -20px; width: 100%; text-align: center; font-size: 11px; font-weight: bold; color: #667eea; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 5% auto; padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .close-modal { float: right; font-size: 28px; font-weight: bold; cursor: pointer; color: #aaa; }
        .close-modal:hover { color: #000; }
        .badge { display: inline-block; padding: 8px 15px; margin: 5px; border-radius: 20px; background: linear-gradient(135deg, #ffd700, #ffed4e); font-size: 0.9em; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .badge.locked { background: #ddd; color: #999; }
        .template-item { padding: 10px; background: #f8f8f8; margin: 5px 0; border-radius: 8px; cursor: pointer; }
        .template-item:hover { background: #e8e8e8; }
        .comparison-row { display: flex; gap: 20px; margin-top: 15px; }
        .comparison-card { flex: 1; padding: 15px; background: #f8f8f8; border-radius: 10px; }
        .time-input { width: 80px; padding: 5px; border: 1px solid #ddd; border-radius: 5px; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; margin-top: 10px; }
        .photo-item { aspect-ratio: 1; background: #f0f0f0; border-radius: 8px; overflow: hidden; position: relative; cursor: pointer; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; }
        .photo-item img { width: 100%; height: 100%; object-fit: cover; }
        .photo-item .add-photo { font-size: 2em; color: #999; }
        .mood-btn { 
            font-size: 2em; padding: 10px 20px; border: 2px solid #e0e0e0; 
            background: white; border-radius: 12px; cursor: pointer; transition: all 0.2s;
        }
        .mood-btn:hover { transform: scale(1.1); border-color: #667eea; }
        .mood-btn.selected { border-color: #667eea; background: #f0f4ff; transform: scale(1.15); }
        .journal-entry { 
            padding: 15px; margin: 10px 0; background: #f8f9fa; 
            border-radius: 10px; border-left: 4px solid #667eea; 
        }
        .journal-entry-date { font-weight: 600; color: #667eea; margin-bottom: 8px; }
        .insight-card { 
            padding: 20px; margin: 15px 0; background: linear-gradient(135deg, #667eea15, #764ba215); 
            border-radius: 12px; border-left: 4px solid #667eea;
        }
        .insight-title { font-size: 1.2em; font-weight: 600; margin-bottom: 10px; color: #333; }
        .insight-value { font-size: 2em; font-weight: bold; color: #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Habit Tracker Pro</h1>
            <div id="monthDisplay" class="month-display"></div>
            <div class="quote-box" id="dailyQuote"></div>
        </div>

        <div class="stats">
            <div class="stat-item"><div class="stat-number" id="totalHabits">0</div><div class="stat-label">Habits</div></div>
            <div class="stat-item"><div class="stat-number" id="todayChecked">0</div><div class="stat-label">Selesai Hari Ini</div></div>
            <div class="stat-item"><div class="stat-number" id="longestStreak">0</div><div class="stat-label">Longest Streak üî•</div></div>
            <div class="stat-item"><div class="stat-number" id="totalBadges">0</div><div class="stat-label">Badges Unlocked üèÜ</div></div>
        </div>

        <div class="input-section">
            <h3>‚ûï Tambah Habit Baru</h3>
            <div class="input-row">
                <input type="text" id="habitInput" placeholder="Habit baru...">
                <select id="categorySelect">
                    <option value="kesehatan">üèÉ Kesehatan</option>
                    <option value="produktivitas">üíº Produktivitas</option>
                    <option value="belajar">üìö Belajar</option>
                    <option value="sosial">üë• Sosial</option>
                    <option value="keuangan">üí∞ Keuangan</option>
                    <option value="kebiasaan">‚ú® Kebiasaan Baik</option>
                </select>
                <input type="number" id="goalInput" placeholder="Target/minggu (opsional)" min="1" max="7">
                <button id="btnTambah" onclick="addHabit()">TAMBAH</button>
            </div>
            <button onclick="openTemplates()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;">üìã Gunakan Template</button>
        </div>

        <div class="analytics-section">
            <h3>üìä View Mode</h3>
            <div class="view-toggle">
                <button class="view-btn active" onclick="switchView('table')">üìÖ Tabel</button>
                <button class="view-btn" onclick="switchView('calendar')">üìÜ Kalender</button>
                <button class="view-btn" onclick="openBadges()">üèÜ Badges</button>
                <button class="view-btn" onclick="openComparison()">üìà Perbandingan</button>
                <button class="view-btn" onclick="openInsights()">üí° Insights</button>
            </div>
        </div>

        <div id="tableView" class="table-wrapper">
            <h3>üóìÔ∏è Habit Tracker - 7 Hari Terakhir</h3>
            <div class="table-container">
                <table>
                    <thead><tr id="tableHeader"><th>Habit</th></tr></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="calendarView" class="table-wrapper" style="display: none;">
            <h3>üìÜ Calendar View</h3>
            <div class="calendar-grid" id="calendarGrid"></div>
        </div>

        <div class="analytics-section">
            <h3>üìà 7 Hari Terakhir</h3>
            <div class="bar-chart" id="weeklyChart"></div>
        </div>

        <div class="reflection-section">
            <h3>üìù Journal & Refleksi</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    üòä Mood Hari Ini
                </label>
                <div style="display: flex; gap: 10px;">
                    <button class="mood-btn" data-mood="üò≠" onclick="setMood('üò≠')">üò≠</button>
                    <button class="mood-btn" data-mood="üòî" onclick="setMood('üòî')">üòî</button>
                    <button class="mood-btn" data-mood="üòê" onclick="setMood('üòê')">üòê</button>
                    <button class="mood-btn" data-mood="üôÇ" onclick="setMood('üôÇ')">üôÇ</button>
                    <button class="mood-btn" data-mood="üòÑ" onclick="setMood('üòÑ')">üòÑ</button>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    ‚ö° Energy Level (1-10)
                </label>
                <input type="range" id="energyLevel" min="1" max="10" value="5" 
                    style="width: 100%; accent-color: #667eea;">
                <div style="display: flex; justify-content: space-between; font-size: 0.85em; color: #666;">
                    <span>üò¥ Low</span>
                    <span id="energyValue">5</span>
                    <span>‚ö° High</span>
                </div>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    ‚ú® Highlight Hari Ini
                </label>
                <input type="text" id="dailyHighlight" placeholder="Apa yang bikin hari ini spesial?" 
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    üéØ Goal Besok
                </label>
                <input type="text" id="tomorrowGoal" placeholder="Mau achieve apa besok?" 
                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                    üí≠ Catatan & Refleksi
                </label>
                <textarea id="dailyReflection" placeholder="Tulis apapun yang lo rasain hari ini..." 
                    style="width: 100%; min-height: 120px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; resize: vertical;"></textarea>
            </div>

            <button onclick="viewJournalHistory()" 
                style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                üìö Lihat Riwayat Journal
            </button>
        </div>

        <!-- Modal Journal History -->
        <div id="journalModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('journalModal')">&times;</span>
                <h2>üìö Riwayat Journal</h2>
                <div id="journalHistory"></div>
            </div>
        </div>

        <!-- Modal Insights -->
        <div id="insightsModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('insightsModal')">&times;</span>
                <h2>üí° Personal Insights</h2>
                <div id="insightsContent"></div>
            </div>
        </div>

        <!-- Modal untuk detail hari -->
        <div id="dayModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('dayModal')">&times;</span>
                <h2 id="modalDayTitle"></h2>
                <div id="modalDayContent"></div>
            </div>
        </div>

        <!-- Modal untuk habit detail -->
        <div id="habitModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('habitModal')">&times;</span>
                <h2 id="habitModalTitle"></h2>
                <div id="habitModalContent"></div>
                <h4 style="margin-top: 20px;">üì∏ Progress Photos</h4>
                <div class="photo-grid" id="photoGrid"></div>
            </div>
        </div>

        <!-- Modal Templates -->
        <div id="templateModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('templateModal')">&times;</span>
                <h2>üìã Template Habits</h2>
                <div id="templateList"></div>
            </div>
        </div>

        <!-- Modal Badges -->
        <div id="badgeModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('badgeModal')">&times;</span>
                <h2>üèÜ Achievement Badges</h2>
                <div id="badgeList"></div>
            </div>
        </div>

        <!-- Modal Comparison -->
        <div id="comparisonModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal('comparisonModal')">&times;</span>
                <h2>üìà Perbandingan Mingguan</h2>
                <div id="comparisonContent"></div>
            </div>
        </div>
    </div>

    <script>
        let habits = [];
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        const todayDate = now.getDate();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        let currentView = 'table';

        const quotes = [
            "Sukses adalah hasil dari kebiasaan kecil yang konsisten.",
            "Jangan putus asa, lo udah lebih jauh dari kemarin!",
            "Setiap hari adalah kesempatan baru untuk jadi lebih baik.",
            "Habit yang baik adalah investasi terbaik untuk masa depan.",
            "Konsistensi mengalahkan bakat. Keep going!",
            "Lo gak perlu sempurna, lo cuma perlu mulai.",
            "Progress kecil setiap hari = perubahan besar dalam hidup.",
            "Hari ini adalah hari yang sempurna untuk memulai."
        ];

        const templates = [
            { name: "Tidur 8 jam", category: "kesehatan", goal: 7 },
            { name: "Olahraga 30 menit", category: "kesehatan", goal: 3 },
            { name: "Minum 8 gelas air", category: "kesehatan", goal: 7 },
            { name: "Meditasi 10 menit", category: "kesehatan", goal: 5 },
            { name: "Mandi pagi", category: "kebiasaan", goal: 7 },
            { name: "Coding 30 menit", category: "belajar", goal: 5 },
            { name: "Baca buku 20 halaman", category: "belajar", goal: 5 },
            { name: "Belajar bahasa asing", category: "belajar", goal: 5 },
            { name: "No sosmed pagi", category: "produktivitas", goal: 7 },
            { name: "Journaling", category: "produktivitas", goal: 5 },
            { name: "Planning esok hari", category: "produktivitas", goal: 7 },
            { name: "Hubungi teman/keluarga", category: "sosial", goal: 3 },
            { name: "Catat pengeluaran", category: "keuangan", goal: 7 },
            { name: "Rapihkan kamar", category: "kebiasaan", goal: 3 }
        ];

        const badges = [
            { id: "starter", name: "üå± Starter", desc: "Mulai habit pertama", req: () => habits.length >= 1 },
            { id: "week1", name: "üî• Week Warrior", desc: "Streak 7 hari", req: () => habits.some(h => calculateStreak(h) >= 7) },
            { id: "month1", name: "üí™ Monthly Master", desc: "Streak 30 hari", req: () => habits.some(h => calculateStreak(h) >= 30) },
            { id: "hundred", name: "üíØ Century Club", desc: "Streak 100 hari", req: () => habits.some(h => calculateStreak(h) >= 100) },
            { id: "perfect", name: "‚≠ê Perfect Day", desc: "Semua habit selesai dalam 1 hari", req: () => habits.length > 0 && habits.every(h => h.checks[todayDate]) },
            { id: "diverse", name: "üé® Diversifier", desc: "Punya 5+ habits berbeda", req: () => habits.length >= 5 },
            { id: "social", name: "üë• Social Butterfly", desc: "Punya habit kategori sosial", req: () => habits.some(h => h.category === 'sosial') }
        ];

        function init() {
            loadFromStorage();
            renderHeader();
            renderHabits();
            updateStats();
            renderWeeklyChart();
            renderCalendar();
            setupAutoSave();
            showDailyQuote();
            document.getElementById('monthDisplay').textContent = 
                new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(now);
        }

        function showDailyQuote() {
            const quote = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('dailyQuote').textContent = `"${quote}"`;
        }

        function switchView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            if (view === 'table') {
                document.getElementById('tableView').style.display = 'block';
                document.getElementById('calendarView').style.display = 'none';
            } else if (view === 'calendar') {
                document.getElementById('tableView').style.display = 'none';
                document.getElementById('calendarView').style.display = 'block';
                renderCalendar();
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const dayNames = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.style.fontWeight = 'bold';
                header.style.textAlign = 'center';
                header.textContent = day;
                grid.appendChild(header);
            });

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            for (let i = 0; i < firstDay; i++) {
                grid.appendChild(document.createElement('div'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-day';
                if (day === todayDate) dayDiv.classList.add('today');
                
                const completed = habits.filter(h => h.checks[day]).length;
                const total = habits.length;
                const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                // Warna calendar berdasarkan completion
                let calendarBg = '#f8f9fa';
                let calendarBorder = 'transparent';
                if (percentage >= 80) {
                    calendarBg = '#d5f4e6';
                    calendarBorder = '#27ae60';
                } else if (percentage >= 60) {
                    calendarBg = '#dae8fc';
                    calendarBorder = '#3498db';
                } else if (percentage >= 40) {
                    calendarBg = '#fff4e6';
                    calendarBorder = '#f39c12';
                } else if (percentage > 0) {
                    calendarBg = '#fde2e4';
                    calendarBorder = '#e74c3c';
                }
                
                dayDiv.innerHTML = `
                    <div class="day-num">${day}</div>
                    <div class="completion">${completed}/${total}</div>
                `;
                dayDiv.style.background = calendarBg;
                dayDiv.style.borderColor = calendarBorder;
                dayDiv.onclick = () => openDayDetail(day);
                grid.appendChild(dayDiv);
            }
        }

        function openDayDetail(day) {
            const modal = document.getElementById('dayModal');
            const title = document.getElementById('modalDayTitle');
            const content = document.getElementById('modalDayContent');
            
            title.textContent = `Detail - Tanggal ${day}`;
            
            let html = '<div>';
            if (habits.length === 0) {
                html += '<p>Belum ada habit.</p>';
            } else {
                habits.forEach(habit => {
                    const checked = habit.checks[day] || false;
                    const timeSpent = habit.timeLog?.[day] || 0;
                    const note = habit.notes?.[day] || '';
                    
                    html += `
                        <div style="padding: 10px; margin: 10px 0; background: #f8f8f8; border-radius: 8px;">
                            <strong>${checked ? '‚úÖ' : '‚¨ú'} ${habit.name}</strong>
                            <span class="category-badge cat-${habit.category}">${getCategoryEmoji(habit.category)} ${habit.category}</span><br>
                            ${timeSpent > 0 ? `‚è±Ô∏è ${timeSpent} menit` : ''}
                            ${note ? `<br>üìù ${note}` : ''}
                        </div>
                    `;
                });
            }
            html += '</div>';
            content.innerHTML = html;
            modal.style.display = 'block';
        }

        function getCategoryEmoji(cat) {
            const emojis = {
                kesehatan: 'üèÉ', produktivitas: 'üíº', belajar: 'üìö',
                sosial: 'üë•', keuangan: 'üí∞', kebiasaan: '‚ú®'
            };
            return emojis[cat] || 'üìå';
        }

        function renderHeader() {
            const header = document.getElementById('tableHeader');
            header.innerHTML = '<th>Habit</th>';
            
            // Hanya tampilkan 7 hari terakhir
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const dayNum = todayDate - i;
                if (dayNum >= 1) days.push(dayNum);
            }
            
            days.forEach(day => {
                const date = new Date(currentYear, currentMonth, day);
                const dayName = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'][date.getDay()];
                const th = document.createElement('th');
                th.innerHTML = `<div style="font-size: 0.85em;">${dayName}</div><div>${day}</div>`;
                if (day === todayDate) th.classList.add('today-col');
                header.appendChild(th);
            });
        }

        function addHabit() {
            const input = document.getElementById('habitInput');
            const category = document.getElementById('categorySelect').value;
            const goal = parseInt(document.getElementById('goalInput').value) || 0;
            
            if (!input.value.trim()) return;
            
            const newHabit = {
                id: Date.now(),
                name: input.value.trim(),
                category: category,
                goal: goal,
                checks: {},
                timeLog: {},
                notes: {},
                photos: {}
            };
            habits.push(newHabit);
            input.value = '';
            document.getElementById('goalInput').value = '';
            saveAndRefresh();
            checkGoals();
        }

        function toggleCheck(id, day) {
            const habit = habits.find(h => h.id === id);
            if (habit) {
                habit.checks[day] = !habit.checks[day];
                saveAndRefresh();
                checkGoals();
            }
        }

        function calculateStreak(habit) {
            let streak = 0;
            for (let i = todayDate; i >= 1; i--) {
                if (habit.checks[i]) streak++;
                else if (i < todayDate) break;
            }
            return streak;
        }

        function checkGoals() {
            habits.forEach(habit => {
                if (habit.goal > 0) {
                    const weekStart = Math.max(1, todayDate - 6);
                    let weeklyCount = 0;
                    for (let d = weekStart; d <= todayDate; d++) {
                        if (habit.checks[d]) weeklyCount++;
                    }
                    
                    if (weeklyCount >= habit.goal && !habit.goalNotified) {
                        habit.goalNotified = true;
                        alert(`üéâ Congrats! Lo udah capai target ${habit.name}: ${habit.goal}x/minggu!`);
                    }
                }
            });
        }

        function renderHabits() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            
            if (habits.length === 0) {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    const dayNum = todayDate - i;
                    if (dayNum >= 1) days.push(dayNum);
                }
                tbody.innerHTML = `<tr><td colspan="${days.length + 1}" style="text-align: center; padding: 30px; color: #999;">Belum ada habit. Yuk mulai sekarang! üí™</td></tr>`;
                return;
            }

            // Hitung hari yang ditampilkan
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const dayNum = todayDate - i;
                if (dayNum >= 1) days.push(dayNum);
            }

            habits.forEach(habit => {
                const tr = document.createElement('tr');
                const streak = calculateStreak(habit);
                const goalText = habit.goal > 0 ? `üéØ ${habit.goal}/minggu` : '';
                
                // Hitung completion rate 7 hari terakhir
                let completed = 0;
                days.forEach(d => { if (habit.checks[d]) completed++; });
                const percentage = days.length > 0 ? Math.round((completed / days.length) * 100) : 0;
                
                // Tentukan warna progress bar berdasarkan persentase
                let barColor = '#e74c3c'; // Merah (poor)
                let barGradient = '#e74c3c';
                let statusEmoji = 'üò¢';
                let statusText = 'Perlu Ditingkatkan';
                
                if (percentage >= 80) {
                    barColor = '#27ae60'; // Hijau (excellent)
                    barGradient = '#27ae60';
                    statusEmoji = 'üî•';
                    statusText = 'Excellent!';
                } else if (percentage >= 60) {
                    barColor = '#3498db'; // Biru (good)
                    barGradient = '#3498db';
                    statusEmoji = 'üí™';
                    statusText = 'Good Job!';
                } else if (percentage >= 40) {
                    barColor = '#f39c12'; // Orange (okay)
                    barGradient = '#f39c12';
                    statusEmoji = 'üëç';
                    statusText = 'Keep Going';
                }
                
                // Tentukan warna badge streak
                let streakColor = '#95a5a6';
                if (streak >= 30) streakColor = '#e74c3c'; // Merah hot
                else if (streak >= 14) streakColor = '#f39c12'; // Orange
                else if (streak >= 7) streakColor = '#3498db'; // Biru
                
                let tdName = `<td style="min-width: 200px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                        <strong>${habit.name}</strong>
                        <span class="category-badge cat-${habit.category}">${getCategoryEmoji(habit.category)}</span>
                    </div>
                    <div style="font-size: 0.85em; color: ${streakColor}; margin-bottom: 5px; font-weight: 600;">
                        üî• ${streak} hari ${goalText ? '| ' + goalText : ''}
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 5px;">
                        <div style="flex: 1; height: 8px; background: #ecf0f1; border-radius: 10px; overflow: hidden;">
                            <div style="height: 100%; width: ${percentage}%; background: ${barGradient}; border-radius: 10px; transition: width 0.3s ease;"></div>
                        </div>
                        <span style="font-size: 0.85em; font-weight: 600; min-width: 35px; color: ${barColor};">${percentage}%</span>
                    </div>
                    <div style="font-size: 0.75em; color: ${barColor}; font-weight: 600; margin-bottom: 8px;">
                        ${statusEmoji} ${statusText}
                    </div>
                    <div style="margin-top: 8px;">
                        <button class="edit-btn" onclick="openHabitDetail(${habit.id})">Detail</button>
                        <button class="delete-btn" onclick="deleteHabit(${habit.id})">Hapus</button>
                    </div>
                </td>`;
                tr.innerHTML = tdName;

                days.forEach(d => {
                    const td = document.createElement('td');
                    if (d === todayDate) td.classList.add('today-col');

                    const cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.checked = habit.checks[d] || false;
                    
                    // Tambah visual feedback untuk hari yang completed
                    if (habit.checks[d]) {
                        td.style.background = '#d5f4e6';
                    }

                    if (d === todayDate) {
                        cb.onchange = () => {
                            toggleCheck(habit.id, d);
                            // Update background saat toggle
                            if (cb.checked) {
                                td.style.background = '#d5f4e6';
                            } else {
                                td.style.background = '';
                            }
                        };
                    } else {
                        cb.disabled = true;
                        cb.title = d < todayDate ? "Masa lalu" : "Belum waktunya";
                    }

                    td.appendChild(cb);
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function openHabitDetail(id) {
            const habit = habits.find(h => h.id === id);
            if (!habit) return;

            const modal = document.getElementById('habitModal');
            document.getElementById('habitModalTitle').textContent = habit.name;
            
            let html = `
                <p><strong>Kategori:</strong> <span class="category-badge cat-${habit.category}">${getCategoryEmoji(habit.category)} ${habit.category}</span></p>
                <p><strong>Current Streak:</strong> üî• ${calculateStreak(habit)} hari</p>
                <p><strong>Target:</strong> ${habit.goal > 0 ? habit.goal + 'x/minggu' : 'Tidak ada'}</p>
                <hr style="margin: 15px 0;">
                <h4>‚è±Ô∏è Time Tracker Hari Ini</h4>
                <input type="number" class="time-input" id="timeInput" placeholder="Menit" value="${habit.timeLog?.[todayDate] || ''}">
                <button onclick="saveTime(${id})" style="padding: 5px 15px; margin-left: 10px;">Simpan</button>
                <h4 style="margin-top: 15px;">üìù Catatan Hari Ini</h4>
                <textarea id="noteInput" style="width: 100%; padding: 10px; border-radius: 8px;">${habit.notes?.[todayDate] || ''}</textarea>
                <button onclick="saveNote(${id})" style="padding: 8px 20px; margin-top: 10px;">Simpan Catatan</button>
            `;
            
            document.getElementById('habitModalContent').innerHTML = html;
            renderPhotoGrid(habit);
            modal.style.display = 'block';
        }

        function saveTime(id) {
            const habit = habits.find(h => h.id === id);
            const time = parseInt(document.getElementById('timeInput').value) || 0;
            if (!habit.timeLog) habit.timeLog = {};
            habit.timeLog[todayDate] = time;
            saveAndRefresh();
            alert('‚è±Ô∏è Time saved!');
        }

        function saveNote(id) {
            const habit = habits.find(h => h.id === id);
            const note = document.getElementById('noteInput').value;
            if (!habit.notes) habit.notes = {};
            habit.notes[todayDate] = note;
            saveAndRefresh();
            alert('üìù Catatan tersimpan!');
        }

        function renderPhotoGrid(habit) {
            const grid = document.getElementById('photoGrid');
            grid.innerHTML = '';
            
            const photos = habit.photos?.[todayDate] || [];
            photos.forEach((photo, idx) => {
                const item = document.createElement('div');
                item.className = 'photo-item';
                item.innerHTML = `<img src="${photo}" alt="Progress">`;
                item.onclick = () => {
                    if (confirm('Hapus foto ini?')) {
                        photos.splice(idx, 1);
                        saveAndRefresh();
                        renderPhotoGrid(habit);
                    }
                };
                grid.appendChild(item);
            });

            if (photos.length < 4) {
                const addBtn = document.createElement('div');
                addBtn.className = 'photo-item';
                addBtn.innerHTML = '<div class="add-photo">+</div>';
                addBtn.onclick = () => addPhoto(habit.id);
                grid.appendChild(addBtn);
            }
        }

        function addPhoto(habitId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const habit = habits.find(h => h.id === habitId);
                        if (!habit.photos) habit.photos = {};
                        if (!habit.photos[todayDate]) habit.photos[todayDate] = [];
                        habit.photos[todayDate].push(event.target.result);
                        saveAndRefresh();
                        renderPhotoGrid(habit);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function updateStats() {
            document.getElementById('totalHabits').textContent = habits.length;
            document.getElementById('todayChecked').textContent = habits.filter(h => h.checks[todayDate]).length;
            
            let maxStreak = 0;
            habits.forEach(h => {
                const s = calculateStreak(h);
                if (s > maxStreak) maxStreak = s;
            });
            document.getElementById('longestStreak').textContent = maxStreak;

            const unlockedBadges = badges.filter(b => b.req()).length;
            document.getElementById('totalBadges').textContent = unlockedBadges;
        }

        function renderWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            chart.innerHTML = '';
            for (let i = 6; i >= 0; i--) {
                const dayNum = todayDate - i;
                if (dayNum < 1) continue;
                
                const done = habits.filter(h => h.checks[dayNum]).length;
                const total = habits.length;
                const height = total > 0 ? (done / total) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = height + '%';
                bar.innerHTML = `
                    <div class="bar-value">${done}/${total}</div>
                    <div class="bar-label">${dayNum}</div>
                `;
                chart.appendChild(bar);
            }
        }

        function openTemplates() {
            const modal = document.getElementById('templateModal');
            const list = document.getElementById('templateList');
            
            list.innerHTML = templates.map(t => `
                <div class="template-item" onclick="addFromTemplate('${t.name}', '${t.category}', ${t.goal})">
                    ${getCategoryEmoji(t.category)} ${t.name} - ${t.goal}x/minggu
                </div>
            `).join('');
            
            modal.style.display = 'block';
        }

        function addFromTemplate(name, category, goal) {
            document.getElementById('habitInput').value = name;
            document.getElementById('categorySelect').value = category;
            document.getElementById('goalInput').value = goal;
            closeModal('templateModal');
        }

        function openBadges() {
            const modal = document.getElementById('badgeModal');
            const list = document.getElementById('badgeList');
            
            list.innerHTML = badges.map(b => {
                const unlocked = b.req();
                return `
                    <div class="badge ${unlocked ? '' : 'locked'}">
                        ${b.name}<br>
                        <small>${b.desc}</small>
                    </div>
                `;
            }).join('');
            
            modal.style.display = 'block';
        }

        function openComparison() {
            const modal = document.getElementById('comparisonModal');
            const content = document.getElementById('comparisonContent');
            
            const thisWeekStart = Math.max(1, todayDate - 6);
            const lastWeekStart = Math.max(1, todayDate - 13);
            const lastWeekEnd = Math.max(1, todayDate - 7);
            
            let thisWeekTotal = 0, lastWeekTotal = 0;
            habits.forEach(h => {
                for (let d = thisWeekStart; d <= todayDate; d++) {
                    if (h.checks[d]) thisWeekTotal++;
                }
                for (let d = lastWeekStart; d <= lastWeekEnd; d++) {
                    if (h.checks[d]) lastWeekTotal++;
                }
            });
            
            const diff = thisWeekTotal - lastWeekTotal;
            const diffText = diff > 0 ? `+${diff} ‚úÖ Naik!` : diff < 0 ? `${diff} ‚ö†Ô∏è Turun` : '= Sama';
            
            content.innerHTML = `
                <div class="comparison-row">
                    <div class="comparison-card">
                        <h3>Minggu Lalu</h3>
                        <div class="stat-number">${lastWeekTotal}</div>
                        <div class="stat-label">Total Checks</div>
                    </div>
                    <div class="comparison-card">
                        <h3>Minggu Ini</h3>
                        <div class="stat-number">${thisWeekTotal}</div>
                        <div class="stat-label">Total Checks</div>
                    </div>
                </div>
                <p style="text-align: center; font-size: 1.5em; margin-top: 20px;">${diffText}</p>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function deleteHabit(id) {
            if (confirm('Hapus habit ini?')) {
                habits = habits.filter(h => h.id !== id);
                saveAndRefresh();
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('habitTrackerData', JSON.stringify({
                habits, month: currentMonth, year: currentYear
            }));
            renderHabits();
            updateStats();
            renderWeeklyChart();
            if (currentView === 'calendar') renderCalendar();
        }

        function loadFromStorage() {
            const data = JSON.parse(localStorage.getItem('habitTrackerData'));
            if (data && data.month === currentMonth && data.year === currentYear) {
                habits = data.habits || [];
            }
        }

        function setupAutoSave() {
            const ref = document.getElementById('dailyReflection');
            const highlight = document.getElementById('dailyHighlight');
            const goal = document.getElementById('tomorrowGoal');
            const energy = document.getElementById('energyLevel');
            const energyValue = document.getElementById('energyValue');
            
            const journalKey = 'journal_' + todayDate;
            const savedJournal = JSON.parse(localStorage.getItem(journalKey) || '{}');
            
            ref.value = savedJournal.reflection || '';
            highlight.value = savedJournal.highlight || '';
            goal.value = savedJournal.goal || '';
            energy.value = savedJournal.energy || 5;
            energyValue.textContent = energy.value;
            
            if (savedJournal.mood) {
                document.querySelectorAll('.mood-btn').forEach(btn => {
                    if (btn.dataset.mood === savedJournal.mood) {
                        btn.classList.add('selected');
                    }
                });
            }
            
            const saveJournal = () => {
                const journal = {
                    reflection: ref.value,
                    highlight: highlight.value,
                    goal: goal.value,
                    energy: energy.value,
                    mood: document.querySelector('.mood-btn.selected')?.dataset.mood || null,
                    date: todayDate,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem(journalKey, JSON.stringify(journal));
            };
            
            ref.oninput = saveJournal;
            highlight.oninput = saveJournal;
            goal.oninput = saveJournal;
            energy.oninput = () => {
                energyValue.textContent = energy.value;
                saveJournal();
            };
        }

        function setMood(mood) {
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            const journalKey = 'journal_' + todayDate;
            const savedJournal = JSON.parse(localStorage.getItem(journalKey) || '{}');
            savedJournal.mood = mood;
            localStorage.setItem(journalKey, JSON.stringify(savedJournal));
        }

        function viewJournalHistory() {
            const modal = document.getElementById('journalModal');
            const content = document.getElementById('journalHistory');
            
            let html = '';
            let entries = [];
            
            for (let i = 1; i <= daysInMonth; i++) {
                const journalKey = 'journal_' + i;
                const entry = JSON.parse(localStorage.getItem(journalKey) || 'null');
                if (entry && (entry.reflection || entry.highlight || entry.mood)) {
                    entries.push({ day: i, ...entry });
                }
            }
            
            entries.sort((a, b) => b.day - a.day);
            
            if (entries.length === 0) {
                html = '<p style="text-align: center; color: #999; padding: 30px;">Belum ada journal. Yuk mulai nulis! ‚úçÔ∏è</p>';
            } else {
                entries.forEach(entry => {
                    const date = new Date(currentYear, currentMonth, entry.day);
                    const dateStr = new Intl.DateTimeFormat('id-ID', { 
                        weekday: 'long', day: 'numeric', month: 'long' 
                    }).format(date);
                    
                    html += `
                        <div class="journal-entry">
                            <div class="journal-entry-date">${dateStr} ${entry.mood || ''}</div>
                            ${entry.energy ? `<div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">‚ö° Energy: ${entry.energy}/10</div>` : ''}
                            ${entry.highlight ? `<div style="margin-bottom: 8px;"><strong>‚ú® Highlight:</strong> ${entry.highlight}</div>` : ''}
                            ${entry.goal ? `<div style="margin-bottom: 8px;"><strong>üéØ Goal Besok:</strong> ${entry.goal}</div>` : ''}
                            ${entry.reflection ? `<div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e0e0e0;"><strong>üí≠ Refleksi:</strong><br>${entry.reflection}</div>` : ''}
                        </div>
                    `;
                });
            }
            
            content.innerHTML = html;
            modal.style.display = 'block';
        }

        function openInsights() {
            const modal = document.getElementById('insightsModal');
            const content = document.getElementById('insightsContent');
            
            // Hitung insights
            const totalDays = todayDate;
            const totalPossibleChecks = habits.length * totalDays;
            let totalChecks = 0;
            let moodCounts = {};
            let energySum = 0;
            let energyCount = 0;
            
            habits.forEach(h => {
                for (let d = 1; d <= todayDate; d++) {
                    if (h.checks[d]) totalChecks++;
                }
            });
            
            for (let d = 1; d <= todayDate; d++) {
                const journal = JSON.parse(localStorage.getItem('journal_' + d) || 'null');
                if (journal) {
                    if (journal.mood) {
                        moodCounts[journal.mood] = (moodCounts[journal.mood] || 0) + 1;
                    }
                    if (journal.energy) {
                        energySum += parseInt(journal.energy);
                        energyCount++;
                    }
                }
            }
            
            const overallCompletion = totalPossibleChecks > 0 ? Math.round((totalChecks / totalPossibleChecks) * 100) : 0;
            const avgEnergy = energyCount > 0 ? (energySum / energyCount).toFixed(1) : 'N/A';
            const mostFrequentMood = Object.keys(moodCounts).length > 0 
                ? Object.keys(moodCounts).reduce((a, b) => moodCounts[a] > moodCounts[b] ? a : b)
                : 'üòê';
            
            // Cari best streak
            let bestStreak = 0;
            habits.forEach(h => {
                const s = calculateStreak(h);
                if (s > bestStreak) bestStreak = s;
            });
            
            // Cari kategori favorit
            const categoryCounts = {};
            habits.forEach(h => {
                categoryCounts[h.category] = (categoryCounts[h.category] || 0) + 1;
            });
            const favoriteCategory = Object.keys(categoryCounts).length > 0
                ? Object.keys(categoryCounts).reduce((a, b) => categoryCounts[a] > categoryCounts[b] ? a : b)
                : 'N/A';
            
            content.innerHTML = `
                <div class="insight-card">
                    <div class="insight-title">üìä Overall Completion Rate</div>
                    <div class="insight-value">${overallCompletion}%</div>
                    <p style="color: #666; margin-top: 10px;">Lo udah complete ${totalChecks} dari ${totalPossibleChecks} possible checks bulan ini!</p>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">üî• Best Streak</div>
                    <div class="insight-value">${bestStreak} hari</div>
                    <p style="color: #666; margin-top: 10px;">${bestStreak >= 7 ? 'Amazing! Keep it up! üí™' : 'Terus konsisten yaa! üöÄ'}</p>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">üòä Most Frequent Mood</div>
                    <div class="insight-value">${mostFrequentMood}</div>
                    <p style="color: #666; margin-top: 10px;">Ini mood yang paling sering lo rasain bulan ini</p>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">‚ö° Average Energy Level</div>
                    <div class="insight-value">${avgEnergy}/10</div>
                    <p style="color: #666; margin-top: 10px;">${avgEnergy >= 7 ? 'Energy lo tinggi! ‚ö°' : avgEnergy >= 5 ? 'Energy cukup stabil üëç' : 'Mungkin perlu lebih banyak istirahat üò¥'}</p>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">üé® Kategori Favorit</div>
                    <div class="insight-value">${getCategoryEmoji(favoriteCategory)} ${favoriteCategory}</div>
                    <p style="color: #666; margin-top: 10px;">Kategori yang paling banyak lo fokuskan</p>
                </div>
                
                <div class="insight-card">
                    <div class="insight-title">üí° Rekomendasi</div>
                    <p style="font-size: 1em; color: #333; margin-top: 10px;">
                        ${overallCompletion >= 80 ? 'üåü Lo lagi on fire! Coba challenge diri lo dengan habit baru!' : 
                          overallCompletion >= 60 ? 'üëç Good progress! Fokus maintain consistency yaa!' :
                          overallCompletion >= 40 ? 'üí™ Terus semangat! Coba mulai dari 1-2 habit dulu.' :
                          'üå± Start small! Pilih 1 habit yang paling penting buat lo.'}
                    </p>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        window.onclick = (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        };

        init();
    </script>
</body>
</html>
